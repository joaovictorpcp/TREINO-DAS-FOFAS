[{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\Auth\\AdminRoute.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'useEffect' is defined but never used. Allowed unused vars must match /^[A-Z_]/u.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36,"suggestions":[{"messageId":"removeVar","data":{"varName":"useEffect"},"fix":{"range":[24,35],"text":""},"desc":"Remove unused variable 'useEffect'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Navigate } from 'react-router-dom';\r\nimport { Lock } from 'lucide-react';\r\n\r\nconst AdminRoute = ({ children }) => {\r\n    const [isAuthenticated, setIsAuthenticated] = useState(() => {\r\n        return sessionStorage.getItem('admin_auth') === 'true';\r\n    });\r\n    const [pin, setPin] = useState('');\r\n    const [error, setError] = useState(false);\r\n\r\n    const handleLogin = (e) => {\r\n        e.preventDefault();\r\n        // Hardcoded PIN for \"Trainer\" access - safe enough for localStorage app\r\n        if (pin === '0000') {\r\n            sessionStorage.setItem('admin_auth', 'true');\r\n            setIsAuthenticated(true);\r\n        } else {\r\n            setError(true);\r\n            setPin('');\r\n        }\r\n    };\r\n\r\n    if (isAuthenticated) {\r\n        return children;\r\n    }\r\n\r\n    return (\r\n        <div style={{\r\n            minHeight: '100vh',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            background: 'var(--bg-primary)',\r\n            padding: '1rem'\r\n        }}>\r\n            <div className=\"glass-panel\" style={{\r\n                padding: '2rem',\r\n                width: '100%',\r\n                maxWidth: '400px',\r\n                textAlign: 'center',\r\n                border: '1px solid var(--border-subtle)'\r\n            }}>\r\n                <div style={{\r\n                    width: '60px', height: '60px', background: 'rgba(255, 61, 0, 0.1)',\r\n                    borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    margin: '0 auto 1.5rem', color: 'var(--accent-danger)'\r\n                }}>\r\n                    <Lock size={32} />\r\n                </div>\r\n                <h2 style={{ marginBottom: '0.5rem', color: 'var(--text-primary)' }}>Área Restrita</h2>\r\n                <p style={{ color: 'var(--text-secondary)', marginBottom: '2rem' }}>Digite o PIN do treinador para continuar.</p>\r\n\r\n                <form onSubmit={handleLogin}>\r\n                    <input\r\n                        type=\"password\"\r\n                        inputMode=\"numeric\"\r\n                        pattern=\"[0-9]*\"\r\n                        maxLength=\"4\"\r\n                        placeholder=\"PIN\"\r\n                        className=\"input\"\r\n                        value={pin}\r\n                        onChange={(e) => {\r\n                            setPin(e.target.value);\r\n                            setError(false);\r\n                        }}\r\n                        style={{\r\n                            textAlign: 'center',\r\n                            fontSize: '1.5rem',\r\n                            letterSpacing: '0.5rem',\r\n                            marginBottom: '1rem',\r\n                            borderColor: error ? 'var(--accent-danger)' : 'var(--border-subtle)'\r\n                        }}\r\n                        autoFocus\r\n                    />\r\n                    {error && <p style={{ color: 'var(--accent-danger)', fontSize: '0.9rem', marginBottom: '1rem' }}>PIN Incorreto</p>}\r\n                    <button type=\"submit\" className=\"btn btn-primary\" style={{ width: '100%' }}>\r\n                        Acessar\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={() => window.location.href = '/'}\r\n                        className=\"btn\"\r\n                        style={{ width: '100%', marginTop: '1rem', background: 'transparent', color: 'var(--text-muted)' }}\r\n                    >\r\n                        Voltar\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AdminRoute;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\Auth\\ProtectedRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\ErrorBoundary.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":9,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":42,"suggestions":[{"messageId":"removeVar","data":{"varName":"error"},"fix":{"range":[244,249],"text":""},"desc":"Remove unused variable 'error'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { hasError: false, error: null, errorInfo: null };\r\n    }\r\n\r\n    static getDerivedStateFromError(error) {\r\n        return { hasError: true };\r\n    }\r\n\r\n    componentDidCatch(error, errorInfo) {\r\n        this.setState({\r\n            error: error,\r\n            errorInfo: errorInfo\r\n        });\r\n        console.error(\"Uncaught error:\", error, errorInfo);\r\n    }\r\n\r\n    render() {\r\n        if (this.state.hasError) {\r\n            return (\r\n                <div style={{ padding: '20px', color: 'red', fontFamily: 'monospace' }}>\r\n                    <h1>Something went wrong.</h1>\r\n                    <details style={{ whiteSpace: 'pre-wrap' }}>\r\n                        {this.state.error && this.state.error.toString()}\r\n                        <br />\r\n                        {this.state.errorInfo && this.state.errorInfo.componentStack}\r\n                    </details>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        return this.props.children;\r\n    }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\Layout\\Layout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\Student\\AttendanceCalendar.jsx","messages":[{"ruleId":"no-unused-vars","severity":2,"message":"'viewMode' is assigned a value but never used.","line":6,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":39,"suggestions":[{"messageId":"removeVar","data":{"varName":"viewMode"},"fix":{"range":[388,408],"text":""},"desc":"Remove unused variable 'viewMode'."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState, useEffect } from 'react';\r\nimport { useWorkout } from '../../context/WorkoutContext';\r\nimport { useStudent } from '../../context/StudentContext';\r\nimport { ChevronLeft, ChevronRight, Check, Calendar as CalendarIcon, Clock, Dumbbell, Footprints, Bike, Waves, AlertCircle, XCircle, MapPin, Activity } from 'lucide-react';\r\n\r\nconst AttendanceCalendar = ({ viewMode = 'simple', onDayClick, fullPageMode = false }) => {\r\n    const { workouts, updateWorkout } = useWorkout();\r\n    const { selectedStudentId } = useStudent();\r\n\r\n    const [currentDate, setCurrentDate] = useState(new Date());\r\n    const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\r\n\r\n    useEffect(() => {\r\n        const handleResize = () => setIsMobile(window.innerWidth < 768);\r\n        window.addEventListener('resize', handleResize);\r\n        return () => window.removeEventListener('resize', handleResize);\r\n    }, []);\r\n\r\n    const daysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();\r\n    const firstDayOfMonth = (date) => new Date(date.getFullYear(), date.getMonth(), 1).getDay();\r\n\r\n    const monthData = useMemo(() => {\r\n        if (!selectedStudentId) return [];\r\n        const days = [];\r\n        const totalDays = daysInMonth(currentDate);\r\n        const startDay = firstDayOfMonth(currentDate);\r\n\r\n        // Filter valid workouts\r\n        const monthlyWorkouts = workouts.filter(w => {\r\n            if (w.studentId !== selectedStudentId) return false;\r\n            const wDate = new Date(w.date);\r\n            return wDate.getMonth() === currentDate.getMonth() &&\r\n                wDate.getFullYear() === currentDate.getFullYear();\r\n        });\r\n\r\n        for (let i = 0; i < startDay; i++) days.push({ type: 'padding' });\r\n\r\n        for (let i = 1; i <= totalDays; i++) {\r\n            const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);\r\n            const dayWorkouts = monthlyWorkouts.filter(w => new Date(w.date).getDate() === i);\r\n            days.push({ type: 'day', day: i, date, workouts: dayWorkouts });\r\n        }\r\n        return days;\r\n    }, [currentDate, workouts, selectedStudentId]);\r\n\r\n    const changeMonth = (offset) => {\r\n        setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + offset, 1));\r\n    };\r\n\r\n    // --- TrainingPeaks Block Logic (Dark Theme) ---\r\n    const getActivityIcon = (type) => {\r\n        switch (type) {\r\n            case 'running': return <Footprints size={14} />;\r\n            case 'cycling': return <Bike size={14} />;\r\n            case 'swimming': return <Waves size={14} />;\r\n            default: return <Dumbbell size={14} />;\r\n        }\r\n    };\r\n\r\n    const getBlockStyle = (status) => {\r\n        const s = (status || '').toLowerCase();\r\n        if (s === 'completed' || s === 'done' || s === 'finished') {\r\n            return { bg: 'rgba(0, 230, 118, 0.1)', border: 'var(--accent-primary)', text: 'var(--accent-primary)', icon: <Check size={12} /> };\r\n        }\r\n        if (s === 'missed') {\r\n            return { bg: 'rgba(239, 68, 68, 0.1)', border: 'var(--accent-danger)', text: 'var(--accent-danger)', icon: <XCircle size={12} /> };\r\n        }\r\n        // Future / Planned\r\n        return { bg: 'rgba(255, 255, 255, 0.05)', border: 'var(--border-subtle)', text: 'var(--text-secondary)', icon: null };\r\n    };\r\n\r\n    // --- AGENDA DATA (Mobile) ---\r\n    const agendaData = useMemo(() => {\r\n        if (!selectedStudentId) return [];\r\n        // Show 2 days past, Today, 7 days future\r\n        const center = new Date();\r\n        center.setHours(0, 0, 0, 0);\r\n        const start = new Date(center);\r\n        start.setDate(start.getDate() - 3);\r\n        const end = new Date(center);\r\n        end.setDate(end.getDate() + 14);\r\n\r\n        return workouts\r\n            .filter(w => {\r\n                const d = new Date(w.date);\r\n                return w.studentId === selectedStudentId && d >= start && d <= end;\r\n            })\r\n            .sort((a, b) => new Date(a.date) - new Date(b.date));\r\n    }, [workouts, selectedStudentId]);\r\n\r\n\r\n    return (\r\n        <div style={{\r\n            background: 'var(--bg-card)',\r\n            backdropFilter: 'blur(10px)',\r\n            borderRadius: '16px',\r\n            padding: isMobile ? '1rem' : '1.5rem',\r\n            boxShadow: fullPageMode ? 'none' : 'var(--shadow-card)',\r\n            border: fullPageMode ? 'none' : '1px solid var(--border-subtle)',\r\n            height: fullPageMode && !isMobile ? '100%' : 'auto',\r\n            display: 'flex', flexDirection: 'column'\r\n        }}>\r\n            {/* Header */}\r\n            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '1.5rem' }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                    <h2 style={{ fontSize: isMobile ? '1.1rem' : '1.25rem', fontWeight: 700, color: 'var(--text-primary)', margin: 0 }}>\r\n                        {isMobile ? 'Agenda' : 'Calendário'}\r\n                    </h2>\r\n                    {fullPageMode && !isMobile && (\r\n                        <span style={{ fontSize: '0.9rem', color: 'var(--text-secondary)', background: 'var(--bg-primary)', padding: '2px 8px', borderRadius: '12px', border: '1px solid var(--border-subtle)' }}>Mensal</span>\r\n                    )}\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', background: 'var(--bg-primary)', padding: '4px', borderRadius: '8px', border: '1px solid var(--border-subtle)' }}>\r\n                    <button onClick={() => changeMonth(-1)} style={{ background: 'transparent', border: '1px solid var(--border-subtle)', cursor: 'pointer', padding: '4px', borderRadius: '6px', display: 'flex', color: 'var(--text-secondary)' }}>\r\n                        <ChevronLeft size={16} />\r\n                    </button>\r\n                    <span style={{ fontWeight: 600, color: 'var(--text-primary)', minWidth: isMobile ? '80px' : '120px', textAlign: 'center', fontSize: '0.9rem' }}>\r\n                        {currentDate.toLocaleDateString('pt-BR', { month: isMobile ? 'short' : 'long', year: 'numeric' })}\r\n                    </span>\r\n                    <button onClick={() => changeMonth(1)} style={{ background: 'transparent', border: '1px solid var(--border-subtle)', cursor: 'pointer', padding: '4px', borderRadius: '6px', display: 'flex', color: 'var(--text-secondary)' }}>\r\n                        <ChevronRight size={16} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* CONTENT */}\r\n            {isMobile ? (\r\n                // --- MOBILE AGENDA VIEW ---\r\n                <div className=\"animate-fade-in\" style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>\r\n                    {agendaData.length === 0 ? (\r\n                        <div style={{ padding: '3rem', textAlign: 'center', color: 'var(--text-muted)', background: 'rgba(255,255,255,0.02)', borderRadius: '12px', border: '1px dashed var(--border-subtle)' }}>\r\n                            <CalendarIcon size={32} style={{ marginBottom: '8px', opacity: 0.5 }} />\r\n                            <p>Nenhum treino no período.</p>\r\n                        </div>\r\n                    ) : (\r\n                        agendaData.map((w, idx) => {\r\n                            const wDate = new Date(w.date);\r\n                            const todayStr = new Date().toDateString();\r\n                            const wDateStr = wDate.toDateString();\r\n\r\n                            // let dayLabel = wDate.toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: '2-digit' });\r\n                            // if (wDateStr === todayStr) dayLabel = \"HOJE\";\r\n\r\n                            const s = w.status === 'completed' ? 'completed' : ((wDate < new Date() && w.status !== 'completed') ? 'missed' : 'planned');\r\n                            const style = getBlockStyle(s);\r\n                            const isToday = wDateStr === todayStr;\r\n\r\n                            return (\r\n                                <div key={w.id} onClick={() => onDayClick && onDayClick(w.id)}\r\n                                    style={{\r\n                                        display: 'flex', gap: '16px', position: 'relative'\r\n                                    }}\r\n                                >\r\n                                    {/* Timeline Line */}\r\n                                    {idx !== agendaData.length - 1 && (\r\n                                        <div style={{ position: 'absolute', left: '24px', top: '40px', bottom: '-20px', width: '2px', background: 'var(--border-subtle)' }} />\r\n                                    )}\r\n\r\n                                    {/* Date Bubble */}\r\n                                    <div style={{\r\n                                        display: 'flex', flexDirection: 'column', alignItems: 'center',\r\n                                        minWidth: '50px'\r\n                                    }}>\r\n                                        <div style={{\r\n                                            width: '48px', height: '48px', borderRadius: '12px',\r\n                                            background: isToday ? 'var(--accent-primary)' : 'var(--bg-primary)',\r\n                                            border: isToday ? 'none' : '1px solid var(--border-subtle)',\r\n                                            color: isToday ? 'var(--text-on-accent)' : 'var(--text-secondary)',\r\n                                            display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center',\r\n                                            fontWeight: 700, fontSize: '1rem',\r\n                                            zIndex: 1\r\n                                        }}>\r\n                                            <span style={{ fontSize: '0.6rem', fontWeight: 600, textTransform: 'uppercase', opacity: 0.8 }}>\r\n                                                {wDate.toLocaleDateString('pt-BR', { weekday: 'short' }).slice(0, 3)}\r\n                                            </span>\r\n                                            {wDate.getDate()}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Card */}\r\n                                    <div style={{\r\n                                        flex: 1,\r\n                                        background: 'rgba(255,255,255,0.03)',\r\n                                        borderRadius: '12px',\r\n                                        border: '1px solid var(--border-subtle)',\r\n                                        padding: '12px',\r\n                                        boxShadow: 'none',\r\n                                        borderLeft: `4px solid ${style.border}`\r\n                                    }}>\r\n                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '6px' }}>\r\n                                            <div style={{ fontWeight: 700, color: 'var(--text-primary)', fontSize: '1rem', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                                                {getActivityIcon(w.activity_type)}\r\n                                                {w.category || w.name || 'Treino'}\r\n                                            </div>\r\n                                            {style.icon && <div style={{ color: style.text }}>{style.icon}</div>}\r\n                                        </div>\r\n\r\n                                        <div style={{ display: 'flex', gap: '12px', fontSize: '0.85rem', color: 'var(--text-secondary)' }}>\r\n                                            {w.duration_minutes && (\r\n                                                <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}><Clock size={12} /> {w.duration_minutes}m</span>\r\n                                            )}\r\n                                            {w.distance_km > 0 && (\r\n                                                <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}><MapPin size={12} /> {w.distance_km}km</span>\r\n                                            )}\r\n                                            {!w.duration_minutes && !w.distance_km && (\r\n                                                <span>{w.exercises?.length || 0} Exercícios</span>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })\r\n                    )}\r\n                </div>\r\n\r\n            ) : (\r\n                // --- DESKTOP CALENDAR VIEW (TrainingPeaks Style) ---\r\n                <div style={{ display: 'flex', flexDirection: 'column', flex: 1 }}>\r\n                    {/* Weekday Headers */}\r\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', marginBottom: '8px', borderBottom: '1px solid var(--border-subtle)', paddingBottom: '8px' }}>\r\n                        {['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'].map((d, i) => (\r\n                            <span key={i} style={{ textAlign: 'center', fontSize: '0.8rem', color: 'var(--text-secondary)', fontWeight: 600, textTransform: 'uppercase' }}>{d}</span>\r\n                        ))}\r\n                    </div>\r\n                    {/* Month Grid */}\r\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(7, 1fr)', gridAutoRows: 'minmax(120px, 1fr)', flex: 1, borderLeft: '1px solid var(--border-subtle)', borderTop: '1px solid var(--border-subtle)' }}>\r\n                        {monthData.map((day, idx) => {\r\n                            if (day.type === 'padding') {\r\n                                return <div key={`pad-${idx}`} style={{ background: 'rgba(255,255,255,0.02)', borderRight: '1px solid var(--border-subtle)', borderBottom: '1px solid var(--border-subtle)' }} />;\r\n                            }\r\n\r\n                            const isToday = new Date().toDateString() === day.date.toDateString();\r\n\r\n                            return (\r\n                                <div key={day.date.toString()}\r\n                                    style={{\r\n                                        background: isToday ? 'rgba(204, 255, 0, 0.05)' : 'transparent',\r\n                                        borderRight: '1px solid var(--border-subtle)',\r\n                                        borderBottom: '1px solid var(--border-subtle)',\r\n                                        padding: '8px',\r\n                                        display: 'flex', flexDirection: 'column', gap: '6px',\r\n                                        position: 'relative',\r\n                                        transition: 'background 0.2s',\r\n                                        minHeight: '100px'\r\n                                    }}\r\n                                    onLoad={(e) => e.currentTarget.style.background = isToday ? 'rgba(204, 255, 0, 0.05)' : 'transparent'}\r\n                                    onDragOver={(e) => {\r\n                                        e.preventDefault();\r\n                                        e.dataTransfer.dropEffect = 'move';\r\n                                        e.currentTarget.style.background = 'rgba(255,255,255,0.05)';\r\n                                    }}\r\n                                    onDragLeave={(e) => {\r\n                                        e.currentTarget.style.background = isToday ? 'rgba(204, 255, 0, 0.05)' : 'transparent';\r\n                                    }}\r\n                                    onDrop={(e) => {\r\n                                        e.preventDefault();\r\n                                        e.currentTarget.style.background = isToday ? 'rgba(204, 255, 0, 0.05)' : 'transparent';\r\n                                        const workoutId = e.dataTransfer.getData('text/plain');\r\n                                        if (workoutId && updateWorkout) {\r\n                                            const newDate = new Date(day.date);\r\n                                            newDate.setHours(12, 0, 0, 0); // Noon for safety\r\n                                            updateWorkout(workoutId, { date: newDate.toISOString() });\r\n                                        }\r\n                                    }}\r\n                                >\r\n                                    <span style={{\r\n                                        fontSize: '0.85rem', fontWeight: 700,\r\n                                        color: isToday ? 'var(--accent-primary)' : 'var(--text-secondary)',\r\n                                        marginBottom: '4px', textAlign: 'right'\r\n                                    }}>\r\n                                        {day.day}\r\n                                    </span>\r\n\r\n                                    {/* Workout Blocks */}\r\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '4px', flex: 1 }}>\r\n                                        {day.workouts.map(w => {\r\n                                            const status = w.status === 'completed' ? 'completed' : ((new Date(w.date) < new Date() && w.status !== 'completed') ? 'missed' : 'planned');\r\n                                            const style = getBlockStyle(status);\r\n\r\n                                            return (\r\n                                                <div key={w.id}\r\n                                                    draggable={true}\r\n                                                    onDragStart={(e) => {\r\n                                                        e.dataTransfer.setData('text/plain', w.id);\r\n                                                        e.dataTransfer.effectAllowed = 'move';\r\n                                                        e.currentTarget.style.opacity = '0.5';\r\n                                                    }}\r\n                                                    onDragEnd={(e) => {\r\n                                                        e.currentTarget.style.opacity = '1';\r\n                                                    }}\r\n                                                    onClick={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        onDayClick && onDayClick(w.id);\r\n                                                    }}\r\n                                                    title={w.name}\r\n                                                    style={{\r\n                                                        background: style.bg,\r\n                                                        borderLeft: `3px solid ${style.border}`,\r\n                                                        padding: '6px',\r\n                                                        borderRadius: '4px',\r\n                                                        cursor: 'grab',\r\n                                                        display: 'flex', flexDirection: 'column', gap: '2px',\r\n                                                        fontSize: '0.75rem',\r\n                                                        boxShadow: '0 1px 2px rgba(0,0,0,0.1)',\r\n                                                        transition: 'transform 0.1s',\r\n                                                    }}\r\n                                                    onMouseEnter={e => e.currentTarget.style.transform = 'scale(1.02)'}\r\n                                                    onMouseLeave={e => e.currentTarget.style.transform = 'scale(1)'}\r\n                                                >\r\n                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '4px', fontWeight: 700, color: 'var(--text-primary)', whiteSpace: 'nowrap', overflow: 'hidden' }}>\r\n                                                        {getActivityIcon(w.activity_type)}\r\n                                                        <span style={{ overflow: 'hidden', textOverflow: 'ellipsis' }}>{w.category || 'Treino'}</span>\r\n                                                    </div>\r\n                                                    <div style={{ color: 'var(--text-secondary)', fontSize: '0.7rem', display: 'flex', justifyContent: 'space-between' }}>\r\n                                                        {w.duration_minutes ? <span>{w.duration_minutes}m</span> : <span>{w.exercises?.length}ex</span>}\r\n                                                        {w.distance_km > 0 && <span>{w.distance_km}km</span>}\r\n                                                        {w.normalized_load > 0 && <span style={{ fontWeight: 600 }}>TSS {w.normalized_load}</span>}\r\n                                                    </div>\r\n                                                </div>\r\n                                            );\r\n                                        })}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AttendanceCalendar;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\Student\\BiometricCard.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useMemo has an unnecessary dependency: 'bodyMetrics'. Either exclude it or remove the dependency array.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":56,"suggestions":[{"desc":"Update the dependencies array to be: [selectedStudentId, getBodyMetrics]","fix":{"range":[1183,1231],"text":"[selectedStudentId, getBodyMetrics]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  37 |     useEffect(() => {\n  38 |         if (student) {\n> 39 |             setHeight(student.height || '');\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  40 |             // Handle both camelCase (new) and snake_case (legacy)\n  41 |             const dob = student.birthDate || student.birth_date || '';\n  42 |             setBirthDate(dob);","line":39,"column":13,"nodeType":null,"endLine":39,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useStudent } from '../../context/StudentContext';\r\nimport { Ruler, Scale, Calendar, AlertCircle, Plus, TrendingUp, TrendingDown, Minus, Trash2 } from 'lucide-react';\r\nimport { LineChart, Line, ResponsiveContainer } from 'recharts';\r\nimport Modal from '../ui/Modal';\r\n\r\nconst BiometricCard = () => {\r\n    const { students, selectedStudentId, updateStudent, bodyMetrics, addBodyMetric, getBodyMetrics, deleteBodyMetric } = useStudent();\r\n    const student = students.find(s => s.id === selectedStudentId);\r\n\r\n    const [height, setHeight] = useState('');\r\n    const [birthDate, setBirthDate] = useState('');\r\n    const [age, setAge] = useState(null);\r\n\r\n    // Modal State\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [newWeight, setNewWeight] = useState('');\r\n    const [newDate, setNewDate] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n    // Reactive metrics derived from context\r\n    // This ensures updates in context (from add/delete) reflect immediately without local state lag\r\n    const metrics = React.useMemo(() => {\r\n        return getBodyMetrics(selectedStudentId);\r\n    }, [selectedStudentId, bodyMetrics, getBodyMetrics]);\r\n\r\n    const calculateAge = (dob) => {\r\n        if (!dob) {\r\n            setAge(null);\r\n            return;\r\n        }\r\n        const birthDateObj = new Date(dob);\r\n        const difference = Date.now() - birthDateObj.getTime();\r\n        const ageDate = new Date(difference);\r\n        setAge(Math.abs(ageDate.getUTCFullYear() - 1970));\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (student) {\r\n            setHeight(student.height || '');\r\n            // Handle both camelCase (new) and snake_case (legacy)\r\n            const dob = student.birthDate || student.birth_date || '';\r\n            setBirthDate(dob);\r\n            calculateAge(dob);\r\n            // No need to set metrics state here anymore\r\n        }\r\n    }, [student]);\r\n\r\n    const handleUpdate = () => {\r\n        if (!selectedStudentId) return;\r\n        updateStudent(selectedStudentId, {\r\n            height: parseFloat(height),\r\n            birthDate: birthDate // Save as camelCase\r\n        });\r\n        calculateAge(birthDate);\r\n    };\r\n\r\n    const handleAddWeight = (e) => {\r\n        e.preventDefault();\r\n        if (!newWeight) return;\r\n        addBodyMetric(selectedStudentId, newWeight, newDate);\r\n        setNewWeight('');\r\n        // Don't close modal immediately, user might want to see history\r\n    };\r\n\r\n    const handleDeleteWeight = (id) => {\r\n        if (window.confirm('Tem certeza que deseja apagar este registro?')) {\r\n            deleteBodyMetric(id);\r\n        }\r\n    };\r\n\r\n    if (!student) return null;\r\n\r\n    const currentWeight = metrics.length > 0 ? metrics[metrics.length - 1].weight : (student.weight || '-');\r\n    const previousWeight = metrics.length > 1 ? metrics[metrics.length - 2].weight : null;\r\n    const trend = previousWeight ? (currentWeight - previousWeight) : 0;\r\n\r\n    // Prepare data for small chart (last 10 entries)\r\n    const chartData = metrics.slice(-10).map(m => ({ value: m.weight }));\r\n\r\n    const inputStyle = {\r\n        border: '1px solid #cbd5e1',\r\n        borderRadius: '8px',\r\n        padding: '8px 12px',\r\n        width: '100%',\r\n        fontSize: '0.9rem',\r\n        marginTop: '4px',\r\n        color: '#334155'\r\n    };\r\n\r\n    const labelStyle = {\r\n        fontSize: '0.8rem',\r\n        fontWeight: 600,\r\n        color: '#64748B',\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        gap: '4px'\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div style={{\r\n                background: '#fff',\r\n                borderRadius: '16px',\r\n                padding: '1.5rem',\r\n                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.05)',\r\n                marginBottom: '2rem',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                gap: '1rem'\r\n            }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                    <h2 style={{ fontSize: '1.25rem', fontWeight: 700, color: '#1e293b' }}>\r\n                        Perfil do Aluno\r\n                    </h2>\r\n                    {age !== null && (\r\n                        <span style={{\r\n                            background: '#e0f2fe',\r\n                            color: '#0284c7',\r\n                            padding: '4px 12px',\r\n                            borderRadius: '20px',\r\n                            fontWeight: 600,\r\n                            fontSize: '0.9rem'\r\n                        }}>\r\n                            {age} Anos\r\n                        </span>\r\n                    )}\r\n                </div>\r\n\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1.5rem' }}>\r\n\r\n                    {/* Weight Evolution Card */}\r\n                    <div style={{\r\n                        gridColumn: 'span 2',\r\n                        background: '#f8fafc',\r\n                        borderRadius: '12px',\r\n                        padding: '1rem',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'space-between',\r\n                        border: '1px solid #e2e8f0'\r\n                    }}>\r\n                        <div>\r\n                            <label style={labelStyle}>\r\n                                <Scale size={14} /> Evolução de Peso\r\n                            </label>\r\n                            <div style={{ display: 'flex', alignItems: 'baseline', gap: '8px', marginTop: '4px' }}>\r\n                                <span style={{ fontSize: '1.8rem', fontWeight: 700, color: '#0f172a' }}>\r\n                                    {currentWeight} <span style={{ fontSize: '1rem', fontWeight: 500, color: '#64748B' }}>kg</span>\r\n                                </span>\r\n                                {trend !== 0 && (\r\n                                    <span style={{ fontSize: '0.8rem', color: trend > 0 ? '#ef4444' : '#22c55e', display: 'flex', alignItems: 'center' }}>\r\n                                        {trend > 0 ? <TrendingUp size={12} /> : <TrendingDown size={12} />}\r\n                                        {Math.abs(trend).toFixed(1)}kg\r\n                                    </span>\r\n                                )}\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setIsModalOpen(true)}\r\n                                style={{\r\n                                    marginTop: '8px',\r\n                                    fontSize: '0.8rem',\r\n                                    color: 'var(--accent-primary)',\r\n                                    background: 'none',\r\n                                    border: 'none',\r\n                                    cursor: 'pointer',\r\n                                    fontWeight: 600,\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    gap: '4px'\r\n                                }}\r\n                            >\r\n                                + Registrar Pesagem\r\n                            </button>\r\n                        </div>\r\n\r\n                        {/* Sparkline */}\r\n                        {chartData.length > 1 && (\r\n                            <div style={{ width: '100px', height: '50px' }}>\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <LineChart data={chartData}>\r\n                                        <Line type=\"monotone\" dataKey=\"value\" stroke=\"var(--accent-primary)\" strokeWidth={2} dot={false} />\r\n                                    </LineChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Height */}\r\n                    <div>\r\n                        <label style={labelStyle}>\r\n                            <Ruler size={14} />\r\n                            Altura (cm)\r\n                        </label>\r\n                        <input\r\n                            type=\"number\"\r\n                            placeholder=\"Ex: 175\"\r\n                            value={height}\r\n                            onChange={(e) => setHeight(e.target.value)}\r\n                            onBlur={handleUpdate}\r\n                            style={inputStyle}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Birth Date */}\r\n                    <div>\r\n                        <label style={labelStyle}>\r\n                            <Calendar size={14} />\r\n                            Data de Nascimento\r\n                        </label>\r\n                        <input\r\n                            type=\"date\"\r\n                            value={birthDate}\r\n                            onChange={(e) => {\r\n                                setBirthDate(e.target.value);\r\n                                calculateAge(e.target.value);\r\n                            }}\r\n                            onBlur={handleUpdate}\r\n                            style={inputStyle}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Weight Modal */}\r\n            <Modal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} title=\"Registrar Pesagem\">\r\n                <form onSubmit={handleAddWeight} style={{ marginBottom: '2rem' }}>\r\n                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: '10px', alignItems: 'end' }}>\r\n                        <div>\r\n                            <label style={{ display: 'block', marginBottom: '4px', fontSize: '0.8rem', color: '#64748B' }}>Data</label>\r\n                            <input\r\n                                type=\"date\"\r\n                                className=\"input\"\r\n                                value={newDate}\r\n                                onChange={(e) => setNewDate(e.target.value)}\r\n                                required\r\n                            />\r\n                        </div>\r\n                        <div>\r\n                            <label style={{ display: 'block', marginBottom: '4px', fontSize: '0.8rem', color: '#64748B' }}>Peso (kg)</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                step=\"0.1\"\r\n                                className=\"input\"\r\n                                placeholder=\"0.0\"\r\n                                value={newWeight}\r\n                                onChange={(e) => setNewWeight(e.target.value)}\r\n                                required\r\n                                autoFocus\r\n                            />\r\n                        </div>\r\n                        <button type=\"submit\" className=\"btn btn-primary\" style={{ height: '42px' }}>\r\n                            <Plus size={20} />\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n\r\n                {/* History List */}\r\n                <h4 style={{ fontSize: '0.9rem', color: '#64748B', marginBottom: '10px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Histórico</h4>\r\n                <div style={{ maxHeight: '200px', overflowY: 'auto', border: '1px solid #e2e8f0', borderRadius: '8px' }}>\r\n                    {metrics.length === 0 ? (\r\n                        <div style={{ padding: '1rem', textAlign: 'center', color: '#94a3b8', fontSize: '0.9rem' }}>Nenhum registro.</div>\r\n                    ) : (\r\n                        [...metrics].reverse().map((m) => (\r\n                            <div key={m.id} style={{\r\n                                display: 'flex',\r\n                                justifyContent: 'space-between',\r\n                                alignItems: 'center',\r\n                                padding: '10px 15px',\r\n                                borderBottom: '1px solid #f1f5f9',\r\n                                background: '#fff'\r\n                            }}>\r\n                                <div>\r\n                                    <div style={{ fontWeight: 600, color: '#334155' }}>{m.weight} kg</div>\r\n                                    <div style={{ fontSize: '0.8rem', color: '#94a3b8' }}>{new Date(m.date).toLocaleDateString()}</div>\r\n                                </div>\r\n                                <button\r\n                                    onClick={() => handleDeleteWeight(m.id)}\r\n                                    style={{ background: 'none', border: 'none', color: '#ef4444', cursor: 'pointer', padding: '4px' }}\r\n                                    title=\"Apagar\"\r\n                                >\r\n                                    <Trash2 size={16} />\r\n                                </button>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n            </Modal>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default BiometricCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\ui\\Modal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\components\\ui\\Tooltip.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\context\\ExerciseContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst ExerciseContext = createContext();\r\n\r\nexport const useExercise = () => {\r\n    const context = useContext(ExerciseContext);\r\n    if (!context) {\r\n        throw new Error('useExercise must be used within an ExerciseProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const ExerciseProvider = ({ children }) => {\r\n    const [exercises, setExercises] = useState(() => {\r\n        try {\r\n            const saved = localStorage.getItem('exercises_db');\r\n            return saved ? JSON.parse(saved) : [];\r\n        } catch (error) {\r\n            console.error('Failed to load exercises_db', error);\r\n            return [];\r\n        }\r\n    });\r\n\r\n    useEffect(() => {\r\n        try {\r\n            localStorage.setItem('exercises_db', JSON.stringify(exercises));\r\n        } catch (error) {\r\n            console.error('Failed to save exercises_db', error);\r\n        }\r\n    }, [exercises]);\r\n\r\n    const addExercise = (exerciseData) => {\r\n        // Check if exists by normalized name\r\n        const normalized = exerciseData.normalizedName || exerciseData.name.trim();\r\n        const exists = exercises.find(ex => ex.normalizedName?.toLowerCase() === normalized.toLowerCase());\r\n\r\n        if (exists) {\r\n            return exists; // Return existing\r\n        }\r\n\r\n        const newExercise = {\r\n            id: crypto.randomUUID(),\r\n            createdAt: new Date().toISOString(),\r\n            name: exerciseData.name,\r\n            normalizedName: normalized,\r\n            muscleGroup: exerciseData.muscleGroup || 'Other',\r\n            category: exerciseData.category || 'Strength',\r\n            movementPattern: exerciseData.movementPattern || '',\r\n            equipment: exerciseData.equipment || '',\r\n            isCompound: exerciseData.isCompound !== undefined ? exerciseData.isCompound : false,\r\n            riskFactor: exerciseData.riskFactor || 'Low' // From AI\r\n        };\r\n\r\n        setExercises(prev => [...prev, newExercise]);\r\n        return newExercise;\r\n    };\r\n\r\n    const findExercise = (name) => {\r\n        if (!name) return undefined;\r\n        return exercises.find(ex =>\r\n            ex.name.toLowerCase() === name.toLowerCase() ||\r\n            ex.normalizedName?.toLowerCase() === name.toLowerCase()\r\n        );\r\n    };\r\n\r\n    return (\r\n        <ExerciseContext.Provider value={{\r\n            exercises,\r\n            addExercise,\r\n            findExercise\r\n        }}>\r\n            {children}\r\n        </ExerciseContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\context\\StudentContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":5,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":5,"endColumn":24},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":19,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":35,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":23},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":45,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":45,"endColumn":19},{"ruleId":"no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":54,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":54,"endColumn":23}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst StudentContext = createContext();\r\n\r\nexport const useStudent = () => {\r\n    const context = useContext(StudentContext);\r\n    if (!context) {\r\n        throw new Error('useStudent must be used within a StudentProvider');\r\n    }\r\n    return context;\r\n};\r\n\r\nexport const StudentProvider = ({ children }) => {\r\n    // Load Students\r\n    const [students, setStudents] = useState(() => {\r\n        try {\r\n            const saved = localStorage.getItem('students');\r\n            return saved ? JSON.parse(saved) : [];\r\n        } catch (e) {\r\n            console.error('Failed to load students');\r\n            return [];\r\n        }\r\n    });\r\n\r\n    // Load Selected Student ID\r\n    const [selectedStudentId, setSelectedStudentId] = useState(() => {\r\n        return localStorage.getItem('selectedStudentId') || null;\r\n    });\r\n\r\n    // Load Body Metrics\r\n    const [bodyMetrics, setBodyMetrics] = useState(() => {\r\n        try {\r\n            const saved = localStorage.getItem('bodyMetrics');\r\n            return saved ? JSON.parse(saved) : [];\r\n        } catch (error) {\r\n            console.error('Failed to load body metrics');\r\n            return [];\r\n        }\r\n    });\r\n\r\n    // Persist Students\r\n    useEffect(() => {\r\n        try {\r\n            localStorage.setItem('students', JSON.stringify(students));\r\n        } catch (e) {\r\n            console.error('Failed to save students');\r\n        }\r\n    }, [students]);\r\n\r\n    // Persist Body Metrics\r\n    useEffect(() => {\r\n        try {\r\n            localStorage.setItem('bodyMetrics', JSON.stringify(bodyMetrics));\r\n        } catch (error) {\r\n            console.error('Failed to save body metrics');\r\n        }\r\n    }, [bodyMetrics]);\r\n\r\n    // Persist Selection\r\n    useEffect(() => {\r\n        if (selectedStudentId) {\r\n            localStorage.setItem('selectedStudentId', selectedStudentId);\r\n        } else {\r\n            localStorage.removeItem('selectedStudentId');\r\n        }\r\n    }, [selectedStudentId]);\r\n\r\n    const addStudent = (name, goal, profileData = {}) => {\r\n        const newStudent = {\r\n            id: crypto.randomUUID(),\r\n            created_at: new Date().toISOString(),\r\n            name,\r\n            goal,\r\n            birthDate: profileData.birthDate || null,\r\n            gender: profileData.gender || 'male', // 'male' or 'female'\r\n            height: profileData.height || '',\r\n            ...profileData\r\n        };\r\n\r\n        setStudents(prev => [...prev, newStudent]);\r\n\r\n        // If weight provided, log it as first metric\r\n        if (profileData.weight) {\r\n            addBodyMetric(newStudent.id, profileData.weight, new Date().toISOString().split('T')[0]);\r\n        }\r\n\r\n        // Auto select if it's the first one\r\n        if (students.length === 0) {\r\n            setSelectedStudentId(newStudent.id);\r\n        }\r\n    };\r\n\r\n    const deleteStudent = (id) => {\r\n        setStudents(prev => prev.filter(s => s.id !== id));\r\n        if (selectedStudentId === id) {\r\n            setSelectedStudentId(null);\r\n        }\r\n    };\r\n\r\n    const updateStudent = (id, updatedData) => {\r\n        setStudents(prev => prev.map(s => {\r\n            if (s.id === id) {\r\n                return { ...s, ...updatedData };\r\n            }\r\n            return s;\r\n        }));\r\n    };\r\n\r\n    const addBodyMetric = (studentId, weight, date, skinfolds = null, bodyFat = null, circumferences = null) => {\r\n        const newMetric = {\r\n            id: crypto.randomUUID(),\r\n            studentId,\r\n            weight: parseFloat(weight),\r\n            date,\r\n            skinfolds, // { chest, axilla, triceps, subscapular, abdomen, suprailiac, thigh }\r\n            circumferences, // { arm, forearm, thigh, calf, hips, abdomen, waist, chest, shoulder, neck }\r\n            bodyFat: bodyFat ? parseFloat(bodyFat) : null,\r\n            created_at: new Date().toISOString()\r\n        };\r\n        setBodyMetrics(prev => [...prev, newMetric]);\r\n\r\n        // Also update current weight on student object for caching\r\n        updateStudent(studentId, { weight: parseFloat(weight) });\r\n    };\r\n\r\n    const getBodyMetrics = (studentId) => {\r\n        return bodyMetrics\r\n            .filter(m => m.studentId === studentId)\r\n            .sort((a, b) => new Date(a.date) - new Date(b.date));\r\n    };\r\n\r\n    const deleteBodyMetric = (id) => {\r\n        // Find existing metric\r\n        const metricToDelete = bodyMetrics.find(m => m.id === id);\r\n\r\n        if (metricToDelete) {\r\n            // Filter out the deleted one\r\n            const updatedMetrics = bodyMetrics.filter(m => m.id !== id);\r\n\r\n            // Update state\r\n            setBodyMetrics(updatedMetrics);\r\n\r\n            // Update student current weight cache\r\n            const studentMetrics = updatedMetrics\r\n                .filter(m => m.studentId === metricToDelete.studentId)\r\n                .sort((a, b) => new Date(a.date) - new Date(b.date));\r\n\r\n            const latest = studentMetrics.length > 0 ? studentMetrics[studentMetrics.length - 1] : null;\r\n            updateStudent(metricToDelete.studentId, { weight: latest ? latest.weight : null });\r\n        }\r\n    };\r\n\r\n    const updateBodyMetric = (id, weight, date, skinfolds = null, bodyFat = null, circumferences = null) => {\r\n        setBodyMetrics(prev => {\r\n            const updated = prev.map(m => {\r\n                if (m.id === id) {\r\n                    return {\r\n                        ...m,\r\n                        weight: parseFloat(weight),\r\n                        date,\r\n                        skinfolds: skinfolds || m.skinfolds,\r\n                        circumferences: circumferences || m.circumferences,\r\n                        bodyFat: bodyFat !== undefined ? parseFloat(bodyFat) : m.bodyFat\r\n                    };\r\n                }\r\n                return m;\r\n            });\r\n\r\n            // Update student cache if necessary\r\n            // We need to find the studentId to check if this update affects the 'latest' weight\r\n            const metric = prev.find(m => m.id === id);\r\n            if (metric) {\r\n                // Get all metrics for this student from the NEW updated list\r\n                const studentMetrics = updated\r\n                    .filter(m => m.studentId === metric.studentId)\r\n                    .sort((a, b) => new Date(a.date) - new Date(b.date));\r\n\r\n                const latest = studentMetrics.length > 0 ? studentMetrics[studentMetrics.length - 1] : null;\r\n                updateStudent(metric.studentId, { weight: latest ? latest.weight : null });\r\n            }\r\n\r\n            return updated;\r\n        });\r\n    };\r\n\r\n    return (\r\n        <StudentContext.Provider value={{\r\n            students,\r\n            selectedStudentId,\r\n            setSelectedStudentId,\r\n            addStudent,\r\n            deleteStudent,\r\n            updateStudent,\r\n            bodyMetrics,\r\n            addBodyMetric,\r\n            getBodyMetrics,\r\n            deleteBodyMetric,\r\n            updateBodyMetric\r\n        }}>\r\n            {children}\r\n        </StudentContext.Provider>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\context\\WorkoutContext.jsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":5,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":5,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from 'react';\r\n\r\nconst WorkoutContext = createContext();\r\n\r\nexport const useWorkout = () => {\r\n  const context = useContext(WorkoutContext);\r\n  if (!context) {\r\n    throw new Error('useWorkout must be used within a WorkoutProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const WorkoutProvider = ({ children }) => {\r\n  // Initialize with empty array (clean slate)\r\n  const [workouts, setWorkouts] = useState(() => {\r\n    try {\r\n      const saved = localStorage.getItem('workouts');\r\n      const parsed = saved ? JSON.parse(saved) : [];\r\n      return Array.isArray(parsed) ? parsed : [];\r\n    } catch (error) {\r\n      console.error('Data load error', error);\r\n      return [];\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem('workouts', JSON.stringify(workouts));\r\n    } catch (error) {\r\n      console.error('Data save error', error);\r\n    }\r\n  }, [workouts]);\r\n\r\n  const addWorkout = (workout) => {\r\n    const newWorkout = {\r\n      id: crypto.randomUUID(), // Ensure string ID\r\n      date: new Date().toISOString(),\r\n      ...workout,\r\n    };\r\n    setWorkouts((prev) => {\r\n      const updated = [newWorkout, ...prev];\r\n      // Trigger PMC Recalc if needed (or just let consumer call getPMC)\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  // --- PERFORMANCE LOGIC START ---\r\n\r\n  const calculateVolumeLoad = (workout) => {\r\n    if (!workout || !workout.exercises) return 0;\r\n    return workout.exercises.reduce((total, ex) => {\r\n      // Logic: sets * reps * weight\r\n      const sets = parseInt(ex.sets) || 0;\r\n\r\n      // Reps: Handle ranges \"8-12\" -> 10\r\n      let reps = 0;\r\n      const repsStr = String(ex.reps);\r\n      if (repsStr.toLowerCase().includes('falha')) {\r\n        reps = 15; // Assumption for failure\r\n      } else if (repsStr.includes('-')) {\r\n        const parts = repsStr.split('-').map(p => parseInt(p.trim()));\r\n        if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {\r\n          reps = (parts[0] + parts[1]) / 2;\r\n        } else {\r\n          reps = parseInt(repsStr) || 0;\r\n        }\r\n      } else {\r\n        reps = parseInt(repsStr) || 0;\r\n      }\r\n\r\n      // Weight: Handle 0/NaN (Bodyweight)\r\n      let weight = parseFloat(ex.load) || 0;\r\n      if (weight === 0) {\r\n        // Fallback logic for volume load only\r\n        weight = 20;\r\n      }\r\n\r\n      const exerciseLoad = sets * reps * weight;\r\n      return total + exerciseLoad;\r\n    }, 0);\r\n  };\r\n\r\n  /**\r\n   * Foster Method Calculation (RPE * Duration)\r\n   * This is the TRUTH for the PMC Chart.\r\n   */\r\n  const calculateNormalizedLoad = (workout) => {\r\n    // Scenario A: Explicit Data\r\n    if (workout.normalized_load) return workout.normalized_load;\r\n\r\n    // Check if we have fields to calc it on the fly\r\n    const rpe = parseFloat(workout.session_rpe);\r\n    const duration = parseFloat(workout.duration_minutes);\r\n\r\n    if (!isNaN(rpe) && !isNaN(duration) && rpe > 0 && duration > 0) {\r\n      return rpe * duration;\r\n    }\r\n\r\n    // Scenario B: Fallback / Estimation\r\n    if (!workout.exercises || workout.exercises.length === 0) return 0;\r\n\r\n    // 1. Estimate Duration: Sets * 3 mins\r\n    const totalSets = workout.exercises.reduce((acc, ex) => acc + (parseInt(ex.sets) || 0), 0);\r\n    const estimatedDuration = totalSets * 3;\r\n\r\n    // 2. Estimate RPE: Avg of exercises or 6\r\n    let rpeSum = 0;\r\n    let rpeCount = 0;\r\n    workout.exercises.forEach(ex => {\r\n      const val = parseFloat(ex.rpe);\r\n      if (!isNaN(val) && val > 0) {\r\n        rpeSum += val;\r\n        rpeCount++;\r\n      }\r\n    });\r\n\r\n    const estimatedRpe = rpeCount > 0 ? (rpeSum / rpeCount) : 6;\r\n\r\n    return Math.round(estimatedDuration * estimatedRpe);\r\n  };\r\n\r\n  // PMC Algorithm: ATL (7d), CTL (42d), TSB (CTL - ATL)\r\n  // We need to process workouts chronologically.\r\n  const getPMCData = (studentId) => {\r\n    if (!studentId) return [];\r\n\r\n    // 1. Filter & Sort Workouts for Student\r\n    // 1. Filter & Sort Workouts for Student\r\n    const studentWorkouts = workouts\r\n      .filter(w => {\r\n        const s = (w.status || '').toLowerCase();\r\n        const match = s === 'completed' || s === 'done' || s === 'finished' || w.isCompleted === true;\r\n        return w.studentId === studentId && match;\r\n      })\r\n      .sort((a, b) => new Date(a.date) - new Date(b.date));\r\n\r\n\r\n\r\n    // 2. Aggregate Daily Load\r\n    // We need a continuous timeline. If no workout, load is 0.\r\n    // Let's find start and end date.\r\n    if (studentWorkouts.length === 0) return [];\r\n\r\n    const startDate = new Date(studentWorkouts[0].date);\r\n    const today = new Date();\r\n    const timeline = [];\r\n\r\n    // Create map of date -> normalized load\r\n    const loadMap = {};\r\n    studentWorkouts.forEach(w => {\r\n      const dKey = new Date(w.date).toISOString().split('T')[0];\r\n      const load = calculateNormalizedLoad(w);\r\n\r\n      // Sum load if multiple workouts in one day\r\n      loadMap[dKey] = (loadMap[dKey] || 0) + load;\r\n    });\r\n\r\n    // 3. Calculate EMA (Exponential Moving Average)\r\n    // Formula: EMA_today = (Load_today * k) + (EMA_yesterday * (1-k))\r\n    // k = 2 / (N + 1)\r\n    const k_atl = 2 / (7 + 1);\r\n    const k_ctl = 2 / (42 + 1);\r\n\r\n    let currentATL = 0;\r\n    let currentCTL = 0;\r\n\r\n    // Determine strict range\r\n    const lastWorkoutDate = new Date(studentWorkouts[studentWorkouts.length - 1].date);\r\n    const endDate = new Date(Math.max(today.getTime(), lastWorkoutDate.getTime()));\r\n\r\n    // Iterate day by day from first workout to end of range (future included)\r\n    const iterDate = new Date(startDate);\r\n\r\n    // Safety break\r\n    let limit = 0;\r\n    while (iterDate <= endDate && limit < 10000) {\r\n      const dKey = iterDate.toISOString().split('T')[0];\r\n      const dailyLoad = loadMap[dKey] || 0;\r\n\r\n      // Handle initialization to avoid slow ramp up?\r\n      if (limit === 0 && dailyLoad > 0) {\r\n        currentATL = dailyLoad;\r\n        currentCTL = dailyLoad;\r\n      } else {\r\n        currentATL = (dailyLoad * k_atl) + (currentATL * (1 - k_atl));\r\n        currentCTL = (dailyLoad * k_ctl) + (currentCTL * (1 - k_ctl));\r\n      }\r\n\r\n      const tsb = currentCTL - currentATL; // Form\r\n\r\n      timeline.push({\r\n        date: dKey,\r\n        load: dailyLoad,\r\n        fitness: Math.round(currentCTL), // CTL\r\n        fatigue: Math.round(currentATL), // ATL\r\n        form: Math.round(tsb)            // TSB\r\n      });\r\n\r\n      // Next Day\r\n      iterDate.setDate(iterDate.getDate() + 1);\r\n      limit++;\r\n    }\r\n\r\n    return timeline;\r\n  };\r\n\r\n  // --- PERFORMANCE LOGIC END ---\r\n\r\n  const bulkAddWorkouts = (newWorkouts) => {\r\n    setWorkouts(prev => {\r\n      const updated = [...prev, ...newWorkouts];\r\n      try {\r\n        localStorage.setItem('workouts', JSON.stringify(updated));\r\n      } catch (e) {\r\n        console.error(\"Failed to bulk save workouts\", e);\r\n      }\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  const updateWorkout = (id, updatedData) => {\r\n    setWorkouts(prev => prev.map(w => w.id == id ? { ...w, ...updatedData } : w));\r\n  };\r\n\r\n  const deleteWorkout = (id) => {\r\n    setWorkouts((prev) => prev.filter((w) => w.id !== id));\r\n  };\r\n\r\n  const clearWorkouts = (studentId = null) => {\r\n    if (studentId) {\r\n      setWorkouts((prev) => prev.filter((w) => w.studentId !== studentId));\r\n    } else {\r\n      setWorkouts([]);\r\n      localStorage.removeItem('workouts');\r\n    }\r\n  };\r\n\r\n  const getWorkoutById = (id) => {\r\n    return workouts.find(w => w.id == id);\r\n  };\r\n\r\n  const getExerciseHistory = (exerciseName) => {\r\n    const history = [];\r\n    workouts.forEach(w => {\r\n      w.exercises?.forEach(ex => {\r\n        if (ex.name.toLowerCase() === exerciseName.toLowerCase()) {\r\n          history.push({ date: w.date, ...ex });\r\n        }\r\n      });\r\n    });\r\n    return history.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n  };\r\n\r\n  const getRecentAverageVolume = (weeks = 3) => {\r\n    if (workouts.length === 0) return 0;\r\n    const sortedWorkouts = [...workouts].sort((a, b) => new Date(b.date) - new Date(a.date));\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setDate(cutoffDate.getDate() - (weeks * 7));\r\n    const recentWorkouts = sortedWorkouts.filter(w => new Date(w.date) >= cutoffDate);\r\n    if (recentWorkouts.length === 0) return 0;\r\n    const totalVolume = recentWorkouts.reduce((acc, w) => {\r\n      const sessionVol = w.exercises?.reduce((v, ex) => v + (ex.vtt || 0), 0) || 0;\r\n      return acc + sessionVol;\r\n    }, 0);\r\n    return totalVolume / recentWorkouts.length;\r\n  };\r\n\r\n  const generateFullMesocycle = (baseWorkout) => {\r\n    const newWorkouts = [];\r\n    const baseDate = new Date(baseWorkout.date);\r\n    const meso = baseWorkout.meta?.mesocycle || 1;\r\n\r\n    for (let i = 1; i <= 3; i++) {\r\n      const nextWeek = (baseWorkout.meta?.week || 1) + i;\r\n      if (nextWeek > 4) break;\r\n\r\n      const clonedExercises = baseWorkout.exercises.map(ex => ({\r\n        ...ex,\r\n        id: Date.now() + Math.random(),\r\n        sets: ex.sets,\r\n        reps: ex.reps, // Keep Reps\r\n        load: ex.load, // Keep Load\r\n        rpe: '',\r\n        rir: '',\r\n        vtt: 0,\r\n        suggestProgression: false\r\n      }));\r\n\r\n      const nextDate = new Date(baseDate);\r\n      nextDate.setDate(baseDate.getDate() + (i * 7));\r\n\r\n      newWorkouts.push({\r\n        id: crypto.randomUUID(),\r\n        date: nextDate.toISOString(),\r\n        status: 'planned',\r\n        meta: {\r\n          mesocycle: meso,\r\n          week: nextWeek\r\n        },\r\n        exercises: clonedExercises\r\n      });\r\n    }\r\n    setWorkouts(prev => [...newWorkouts, ...prev]);\r\n  };\r\n\r\n  const mirrorWeekToMonth = (studentId, mesocycle) => {\r\n    // 1. Get Week 1 Workouts for this Student & Mesocycle\r\n    const week1Workouts = workouts.filter(w =>\r\n      w.studentId === studentId &&\r\n      (w.meta?.mesocycle || 1) === mesocycle &&\r\n      (w.meta?.week || 1) === 1\r\n    );\r\n\r\n    if (week1Workouts.length === 0) {\r\n      alert(\"Nenhum treino encontrado na Semana 1 para espelhar.\");\r\n      return;\r\n    }\r\n\r\n    const newWorkouts = [];\r\n\r\n    // 2. Generate Weeks 2, 3, 4\r\n    for (let w = 2; w <= 4; w++) {\r\n      const weekOffsetDays = (w - 1) * 7;\r\n\r\n      week1Workouts.forEach(baseWorkout => {\r\n        const baseDate = new Date(baseWorkout.date);\r\n        const nextDate = new Date(baseDate);\r\n        nextDate.setDate(baseDate.getDate() + weekOffsetDays);\r\n\r\n        // Clone Exercises (Reset performance data)\r\n        const clonedExercises = baseWorkout.exercises.map(ex => ({\r\n          ...ex,\r\n          id: Date.now() + Math.random(), // Unique ID\r\n          // Keep load and reps from source (ex)\r\n          load: ex.load,\r\n          reps: ex.reps,\r\n          rpe: '',  // Reset RPE\r\n          rir: '',  // Reset RIR\r\n          vtt: 0,   // Reset Volume\r\n          suggestProgression: false\r\n        }));\r\n\r\n        newWorkouts.push({\r\n          id: crypto.randomUUID(),\r\n          date: nextDate.toISOString(),\r\n          status: 'planned',\r\n          category: baseWorkout.category,\r\n          studentId: baseWorkout.studentId,\r\n          meta: {\r\n            mesocycle: mesocycle,\r\n            week: w\r\n          },\r\n          exercises: clonedExercises\r\n        });\r\n      });\r\n    }\r\n\r\n    setWorkouts(prev => [...newWorkouts, ...prev]);\r\n    alert(`Sucesso! Espelho realizado. ${newWorkouts.length} novos treinos criados para as semanas 2, 3 e 4.`);\r\n  };\r\n\r\n  const createMesocycle = (programData) => {\r\n    const { name, weeks, baseWorkouts, studentId, startDate } = programData;\r\n    const newWorkouts = [];\r\n    // const mesoId = crypto.randomUUID(); // Unique ID for this specific mesocycle run (optional)\r\n    // We can use a timestamp or increment for the 'mesocycle' number, but let's stick to the user's input or auto-detect\r\n    // For now, let's find the max mesocycle and increment\r\n    const latestMeso = workouts.filter(w => w.studentId === studentId).length > 0\r\n      ? Math.max(...workouts.filter(w => w.studentId === studentId).map(w => w.meta?.mesocycle || 0))\r\n      : 0;\r\n    const nextMesoNum = latestMeso + 1;\r\n\r\n    // Fix: Parse YYYY-MM-DD manually to create a Local Date at midnight\r\n    // new Date('2025-01-05') creates UTC midnight, which shows as previous day 21:00 in UTC-3\r\n    const [y, m, d] = startDate.split('-').map(Number);\r\n    const startObj = new Date(y, m - 1, d); // Local Midnight\r\n\r\n    if (isNaN(startObj.getTime())) {\r\n      console.error(\"Invalid start date provided:\", startDate);\r\n      throw new Error(\"Data de início inválida.\");\r\n    }\r\n\r\n    for (let w = 1; w <= weeks; w++) {\r\n      // Calculate start of this week\r\n      // Week 1 starts on startDate. Week 2 on startDate + 7 days, etc.\r\n      const weekStart = new Date(startObj);\r\n      weekStart.setDate(startObj.getDate() + (w - 1) * 7);\r\n\r\n      baseWorkouts.forEach((base, index) => {\r\n        // Determine targets: either explicit multiple days, explicit single day, or fallback\r\n        let targetDays = [];\r\n\r\n        if (base.scheduledDays && base.scheduledDays.length > 0) {\r\n          targetDays = base.scheduledDays.map(d => parseInt(d));\r\n        } else if (base.scheduledDay !== undefined && base.scheduledDay !== '' && base.scheduledDay !== null) {\r\n          targetDays = [parseInt(base.scheduledDay)];\r\n        }\r\n\r\n        // Helper to create workout for a specific date\r\n        const createWorkoutForDate = (dateObj) => {\r\n          const exercises = base.exercises.map(ex => ({\r\n            id: crypto.randomUUID(),\r\n            name: ex.name,\r\n            sets: ex.sets,\r\n            reps: ex.reps || '',\r\n            load: ex.load || '',\r\n            rpe: '',  // Empty\r\n            rir: '',  // Empty\r\n            vtt: 0,\r\n            suggestProgression: false,\r\n            supersetId: ex.supersetId // Preserve Superset Link\r\n          }));\r\n\r\n          newWorkouts.push({\r\n            id: crypto.randomUUID(),\r\n            studentId,\r\n            date: dateObj.toISOString(),\r\n            status: 'planned',\r\n            category: base.name, // 'Treino A', 'Treino B'\r\n            scheduledDay: dateObj.getDay(), // Persist actual day\r\n\r\n            activity_type: programData.activityType || 'weightlifting',\r\n            duration_minutes: base.duration_minutes,\r\n            distance_km: base.distance_km,\r\n            session_rpe: base.session_rpe,\r\n            drills_description: base.drills_description,\r\n            main_set_description: base.main_set_description,\r\n\r\n            meta: {\r\n              mesocycle: nextMesoNum,\r\n              week: w,\r\n              programName: name\r\n            },\r\n            exercises\r\n          });\r\n        };\r\n\r\n        if (targetDays.length > 0) {\r\n          // Loop through each target day and create a workout\r\n          targetDays.forEach(targetDay => { // 0-6\r\n            let workoutDate = new Date(weekStart);\r\n            const currentDay = workoutDate.getDay();\r\n            let diff = targetDay - currentDay;\r\n            if (diff < 0) diff += 7; // Ensure future or today\r\n            workoutDate.setDate(workoutDate.getDate() + diff);\r\n            createWorkoutForDate(workoutDate);\r\n          });\r\n        } else {\r\n          // Fallback: Simple spacing logic: 0, 2, 4... if no day selected\r\n          let workoutDate = new Date(weekStart);\r\n          const offset = (index * 2) % 7;\r\n          workoutDate.setDate(weekStart.getDate() + offset);\r\n          createWorkoutForDate(workoutDate);\r\n        }\r\n      });\r\n    }\r\n\r\n    setWorkouts(prev => [...newWorkouts, ...prev]);\r\n    return nextMesoNum;\r\n  };\r\n\r\n  const importMesocycle = (fromStudentId, toStudentId, mesocycleNumber) => {\r\n    // 1. Get Source Workouts\r\n    const sourceWorkouts = workouts.filter(w =>\r\n      w.studentId === fromStudentId &&\r\n      (w.meta?.mesocycle || 1) === mesocycleNumber\r\n    ).sort((a, b) => new Date(a.date) - new Date(b.date));\r\n\r\n    if (sourceWorkouts.length === 0) {\r\n      throw new Error(\"Nenhum treino encontrado para importar.\");\r\n    }\r\n\r\n    // 2. Determine Next Mesocycle Number for Target Student\r\n    const targetStudentWorkouts = workouts.filter(w => w.studentId === toStudentId);\r\n    const latestMeso = targetStudentWorkouts.length > 0\r\n      ? Math.max(...targetStudentWorkouts.map(w => w.meta?.mesocycle || 0))\r\n      : 0;\r\n    const newMesoNum = latestMeso + 1;\r\n\r\n    // 3. Calculate Date Offset (Start 'Today')\r\n    const today = new Date();\r\n    const sourceStartDate = new Date(sourceWorkouts[0].date);\r\n\r\n    // Normalize time components to avoid partial day shifts if desired, \r\n    // or just calculate raw diff. Let's act like \"First workout is today\".\r\n    const timeDiff = today.getTime() - sourceStartDate.getTime();\r\n\r\n    // 4. Clone Workouts\r\n    const newWorkouts = sourceWorkouts.map(source => {\r\n      const newDate = new Date(new Date(source.date).getTime() + timeDiff);\r\n\r\n      const clonedExercises = source.exercises.map(ex => ({\r\n        ...ex,\r\n        id: crypto.randomUUID(),\r\n        load: '', // Reset\r\n        rpe: '',\r\n        rir: '',\r\n        vtt: 0,\r\n        suggestProgression: false\r\n      }));\r\n\r\n      return {\r\n        ...source,\r\n        id: crypto.randomUUID(),\r\n        studentId: toStudentId,\r\n        date: newDate.toISOString(),\r\n        status: 'planned',\r\n        meta: {\r\n          ...source.meta,\r\n          mesocycle: newMesoNum, // Assign new incremental meso number\r\n        },\r\n        exercises: clonedExercises\r\n      };\r\n    });\r\n\r\n    setWorkouts(prev => [...newWorkouts, ...prev]);\r\n    return newWorkouts.length;\r\n  };\r\n\r\n  const duplicateMesocycleToNext = (studentId, sourceMeso) => {\r\n    // 1. Get Source Workouts\r\n    const sourceWorkouts = workouts.filter(w =>\r\n      w.studentId === studentId &&\r\n      (w.meta?.mesocycle || 1) === sourceMeso\r\n    );\r\n\r\n    if (sourceWorkouts.length === 0) {\r\n      alert(\"Nenhum treino encontrado neste mesociclo.\");\r\n      return;\r\n    }\r\n\r\n    // 2. New Meso Number\r\n    const latestMeso = workouts.filter(w => w.studentId === studentId).length > 0\r\n      ? Math.max(...workouts.filter(w => w.studentId === studentId).map(w => w.meta?.mesocycle || 0))\r\n      : 0;\r\n    const newMesoNum = latestMeso + 1;\r\n\r\n    // 3. Clone Logic (Assuming 4 weeks duration for previous, simply add 4 weeks to date)\r\n    // Or simpler: Just create \"Plan\" for next meso, keeping relative days same but 4 weeks later.\r\n    const newWorkouts = sourceWorkouts.map(source => {\r\n      const sourceDate = new Date(source.date);\r\n      const newDate = new Date(sourceDate);\r\n      newDate.setDate(sourceDate.getDate() + 28); // +4 Weeks\r\n\r\n      // Clone Exercises (Reset data)\r\n      const clonedExercises = source.exercises.map(ex => ({\r\n        ...ex,\r\n        id: crypto.randomUUID(),\r\n        load: ex.load, // Keep Load\r\n        reps: ex.reps, // Keep Reps\r\n        rpe: '',\r\n        rir: '',\r\n        vtt: 0,\r\n        suggestProgression: false\r\n      }));\r\n\r\n      return {\r\n        ...source,\r\n        id: crypto.randomUUID(),\r\n        date: newDate.toISOString(),\r\n        status: 'planned',\r\n        meta: {\r\n          ...source.meta,\r\n          mesocycle: newMesoNum\r\n        },\r\n        exercises: clonedExercises\r\n      };\r\n    });\r\n\r\n    setWorkouts(prev => [...newWorkouts, ...prev]);\r\n    alert(`Mesociclo #${newMesoNum} criado com sucesso! (${newWorkouts.length} treinos duplicados).`);\r\n    return newMesoNum;\r\n  };\r\n\r\n  return (\r\n    <WorkoutContext.Provider value={{\r\n      workouts,\r\n      addWorkout,\r\n      bulkAddWorkouts,\r\n      deleteWorkout,\r\n      updateWorkout,\r\n      getWorkoutById,\r\n      clearWorkouts,\r\n      calculateVolumeLoad, // Exposed now\r\n      generateFullMesocycle,\r\n      mirrorWeekToMonth,\r\n      createMesocycle,\r\n      getExerciseHistory,\r\n      getRecentAverageVolume,\r\n      getPMCData,\r\n      importMesocycle,\r\n      duplicateMesocycleToNext\r\n    }}>\r\n      {children}\r\n    </WorkoutContext.Provider>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\CreateWorkout.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\Dashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\MesocycleBuilder.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\PerformancePage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\StudentGateway.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\StudentsPage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\WeightTrackerPage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\pages\\WorkoutsPage.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\services\\aiClassifier.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\services\\aiEnduranceGenerator.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\src\\services\\supabase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\joaov\\Documents\\Antigravity\\TREINO DAS FOFAS\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
